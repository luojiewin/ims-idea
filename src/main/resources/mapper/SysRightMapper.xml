<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.roger.ims.dao.SysRightDao">
	<resultMap id="BaseResultMap"
		type="com.roger.ims.entity.SysRight">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<result column="right_id" jdbcType="BIGINT" property="rightId" />
		<result column="right_name" jdbcType="VARCHAR"
			property="rightName" />
		<result column="parent_right" jdbcType="BIGINT"
			property="parentRight" />
		<result column="right_level" jdbcType="INTEGER"
			property="rightLevel" />
		<result column="menu_index" jdbcType="VARCHAR"
			property="menuIndex" />
		<result column="icon" jdbcType="VARCHAR" property="icon" />
		<result column="description" jdbcType="VARCHAR"
			property="description" />
		<result column="creation_time" jdbcType="TIMESTAMP"
			property="creationTime" />
		<result column="creation_user_id" jdbcType="BIGINT"
			property="creationUserId" />
		<result column="last_update_time" jdbcType="TIMESTAMP"
			property="lastUpdateTime" />
		<result column="last_update_user_id" jdbcType="BIGINT"
			property="lastUpdateUserId" />
	</resultMap>
	
	<insert id="add"
		parameterType="com.roger.ims.entity.SysRight">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<selectKey keyProperty="rightId" order="BEFORE"
			resultType="java.lang.Long">
			SELECT LAST_INSERT_ID()
		</selectKey>
		insert into sys_right (right_id, right_name, parent_right,
		right_level, menu_index, icon,
		description, creation_time,
		creation_user_id,
		last_update_time, last_update_user_id)
		values
		(#{rightId,jdbcType=BIGINT}, #{rightName,jdbcType=VARCHAR},
		#{parentRight,jdbcType=BIGINT},
		#{rightLevel,jdbcType=INTEGER},
		#{menuIndex,jdbcType=VARCHAR}, #{icon,jdbcType=VARCHAR},
		#{description,jdbcType=VARCHAR}, #{creationTime,jdbcType=TIMESTAMP},
		#{creationUserId,jdbcType=BIGINT},
		#{lastUpdateTime,jdbcType=TIMESTAMP},
		#{lastUpdateUserId,jdbcType=BIGINT})
	</insert>
	
	
	<select id="findAll" resultMap="BaseResultMap">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select right_id, right_name, parent_right, right_level, menu_index,
		icon, description,
		creation_time, creation_user_id, last_update_time,
		last_update_user_id
		from sys_right
	</select>

	<select id="findRightByUserId" resultMap="BaseResultMap">
		SELECT
		srt.right_id,
		srt.right_name,
		srt.parent_right,
		srt.menu_index,
		srt.icon
		FROM
		sys_user su
		LEFT JOIN sys_user_role_relation surr ON su.user_id = surr.user_id
		LEFT JOIN sys_role_right_relation srrr ON surr.role_id = srrr.role_id
		LEFT JOIN sys_role sr ON sr.role_id = surr.role_id
		LEFT JOIN sys_right
		srt ON srt.right_id = srrr.right_id
		WHERE
		su.login_name = '131212'
		AND
		srt.right_level = '0'
	</select>
	
	<!-- 根据角色获取用户权限 -->
	<select id="findRightsByRoles" resultMap="BaseResultMap">
		SELECT
		srt.right_id,
		srt.right_name,
		srt.parent_right,
		srt.menu_index,
		srt.icon
		FROM
		sys_user su
		LEFT JOIN sys_user_role_relation surr ON
		su.user_id = surr.user_id
		LEFT JOIN sys_role_right_relation srrr ON
		surr.role_id = srrr.role_id
		LEFT JOIN sys_role sr ON sr.role_id =
		surr.role_id
		LEFT JOIN sys_right srt ON srt.right_id = srrr.right_id
		WHERE sr.role_id in
		<foreach collection="list" item="item" index="index" open="("
			close=")" separator=",">
			#{item.roleId}
		</foreach>
	</select>


</mapper>