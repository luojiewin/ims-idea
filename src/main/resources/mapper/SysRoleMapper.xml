<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.roger.ims.dao.SysRoleDao">
	<resultMap id="BaseResultMap"
		type="com.roger.ims.entity.SysRole">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<result column="role_id" jdbcType="BIGINT" property="roleId" />
		<result column="role_name" jdbcType="VARCHAR"
			property="roleName" />
		<result column="description" jdbcType="VARCHAR"
			property="description" />
		<result column="creation_time" jdbcType="TIMESTAMP"
			property="creationTime" />
		<result column="creation_user_id" jdbcType="BIGINT"
			property="creationUserId" />
		<result column="last_update_time" jdbcType="TIMESTAMP"
			property="lastUpdateTime" />
		<result column="last_update_user_id" jdbcType="BIGINT"
			property="lastUpdateUserId" />
	</resultMap>

	<!-- 角色管理页面 -->
	<resultMap id="RoleResultMap" type="com.roger.ims.dto.RoleVo">
		<result column="role_id" jdbcType="BIGINT" property="roleId" />
		<result column="role_name" jdbcType="VARCHAR"
			property="roleName" />
		<result column="description" jdbcType="VARCHAR"
			property="description" />
		<result column="creation_time" jdbcType="TIMESTAMP"
			property="creationTime" />
	</resultMap>

	<insert id="add" parameterType="com.roger.ims.entity.SysRole">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<selectKey keyProperty="roleId" order="BEFORE"
			resultType="java.lang.Long">
			SELECT LAST_INSERT_ID()
		</selectKey>
		insert into sys_role (role_name, description,
		creation_time,
		creation_user_id, last_update_time,
		last_update_user_id)
		values
		(
		#{roleName,jdbcType=VARCHAR},
		#{description,jdbcType=VARCHAR},
		#{creationTime,jdbcType=TIMESTAMP},
		#{creationUserId,jdbcType=BIGINT},
		#{lastUpdateTime,jdbcType=TIMESTAMP},
		#{lastUpdateUserId,jdbcType=BIGINT})
	</insert>

	<!-- 角色页面查询 -->
	<select id="findAll" resultMap="BaseResultMap"
		parameterType="com.roger.ims.entity.SysRole">
		select role_id, role_name,
		description, creation_time
		from sys_role
		<where>
			1=1
			<if test="roleName!=null and roleName!=''">
				AND role_name = #{roleName}
			</if>
			<if test="description!=null and description!=''">
				AND description = #{description}
			</if>
		</where>
	</select>

	<!-- 更新角色信息 -->
	<update id="update"
		parameterType="com.roger.ims.entity.SysRole">
		update sys_role
		<set>
			<if test="roleName!=null and roleName!=''">role_name = #{roleName},</if>
			<if test="description!=null and description!=''">description = #{description},</if>
			<if test="lastUpdateUserId!=null and lastUpdateUserId!=''">last_update_user_id = #{lastUpdateUserId}</if>
		</set>
		WHERE role_id = #{roleId}
	</update>

	<!-- 批量删除 -->
	<delete id="deleteRole" parameterType="java.util.List">
		delete from sys_role where role_id in
		<foreach collection="list" index="index" item="item" open="("
			separator="," close=")">
			#{item.roleId}
		</foreach>
	</delete>

	<!-- 登录用户获取角色 -->
	<select id="findRolesByUser" resultMap="BaseResultMap"
		parameterType="com.roger.ims.entity.SysUser">
		SELECT
		sr.role_id,
		sr.role_name,
		sr.description,
		sr.creation_time,
		sr.creation_user_id,
		sr.last_update_time,
		sr.last_update_user_id
		FROM
		sys_user su
		LEFT JOIN sys_user_role_relation surr ON su.user_id = surr.user_id
		LEFT JOIN sys_role sr ON surr.role_id = sr.role_id
		WHERE
		su.user_id = #{userId}
	</select>


</mapper>